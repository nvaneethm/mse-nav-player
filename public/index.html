<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MSE DASH Player</title>
    <style>
      body {
        font-family: sans-serif;
        background-color: #121212;
        color: #fff;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 2rem;
      }

      video {
        display: block;
        width: 100%;
        height: auto;
      }

      button,
      select {
        margin-top: 1rem;
        padding: 10px 20px;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <h1>DASH / MSE Player</h1>
    <video id="video" controls></video>
    <br />
    <button id="playButton">Play Video</button>

    <!-- Dropdown for renditions -->
    <select id="renditionSelector" style="display: none">
      <option disabled selected>Choose Rendition</option>
    </select>

    <p
      id="currentRenditionLabel"
      style="margin-top: 1rem; font-weight: bold"
    ></p>

    <script src="../dist/mse-nav-player.es5.js"></script>
    <script>
      const player = new MseNavPlayer.Player()
      const videoEl = document.getElementById("video")
      const playBtn = document.getElementById("playButton")
      const renditionSelector = document.getElementById("renditionSelector")
      const currentLabel = document.getElementById("currentRenditionLabel")

      player.attachVideoElement(videoEl)

      playBtn.addEventListener("click", async () => {
        // Define content + ad segments
        const segments = [
          {
            start: 0,
            end: 10,
            url: "https://dash.akamaized.net/akamai/bbb_30fps/bbb_30fps_480x270_1500k/bbb_30fps_480x270_1500k_0.m4s",
            type: "content",
          },
          {
            start: 10,
            end: 20,
            url: "https://dash.akamaized.net/akamai/bbb_30fps/bbb_30fps_480x270_1500k/bbb_30fps_480x270_1500k_1.m4s",
            type: "ad",
          },
          {
            start: 20,
            end: 60,
            url: "https://dash.akamaized.net/akamai/bbb_30fps/bbb_30fps_480x270_1500k/bbb_30fps_480x270_1500k_2.m4s",
            type: "content",
          },
        ]

        try {
          // First load the manifest to initialize MediaSourceHandler
          await player.load("https://dash.akamaized.net/akamai/bbb_30fps/bbb_30fps.mpd")

          // Then create and set the timeline
          const timelineModel = new MseNavPlayer.TimelineModel(segments)
          player.setTimeline(timelineModel)

          // Update rendition selector after a delay
          setTimeout(() => {
            const renditions = player.getAvailableRenditions()
            if (renditions && renditions.length > 0) {
              renditionSelector.style.display = "inline-block"
              renditionSelector.innerHTML = `<option disabled selected>Select Rendition</option>`
              renditions.forEach((res) => {
                const option = document.createElement("option")
                option.value = res.resolution
                option.textContent = `${res.resolution} - ${res.bitrate}bps`
                renditionSelector.appendChild(option)
              })
            }
          }, 3000)
        } catch (error) {
          console.error('Error initializing player:', error)
        }
      })

      renditionSelector.addEventListener("change", (e) => {
        const resolution = e.target.value
        player.setRendition(resolution)
        currentLabel.textContent = `ðŸ”„ Switching to: ${resolution}`
      })

      setInterval(() => {
        const currentRes = player.getCurrentRendition?.()
        if (currentRes) {
          currentLabel.textContent = `ðŸ”„ Currently Playing: ${currentRes}`
        }
      }, 2000)
    </script>
  </body>
</html>
